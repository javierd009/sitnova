[
  {
    "aecDelaySamples": 0,
    "aecEnabled": false,
    "aecStepSize": 0,
    "backgroundNoise": "",
    "backgroundNoiseVolume": "0.02",
    "contextApiAuth": null,
    "contextApiBodyTemplate": "",
    "contextApiEnabled": false,
    "contextApiInjectionPoint": "prompt_append",
    "contextApiMethod": "GET",
    "contextApiUrl": "",
    "corpusid": "",
    "description": "Portero Virtual SITNOVA - V2 con espera conversacional (2025-12-06)",
    "extensionEnabled": true,
    "extraTools": [
      {
        "description": "Busca un residente por nombre completo o numero de casa. USAR PRIMERO antes de notificar.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "condominium_id",
            "required": true,
            "schema": {
              "description": "ID del condominio, usar siempre: default-condo-id",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "query",
            "required": true,
            "schema": {
              "description": "Nombre completo del residente o numero de casa",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/buscar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "lookup_resident",
        "timeout": "5s"
      },
      {
        "description": "Envia WhatsApp al residente para autorizar visita. Despues de usar este tool, DEBES usar estado_autorizacion para verificar respuesta.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Numero de casa o apartamento",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre_visitante",
            "required": true,
            "schema": {
              "description": "Nombre completo del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "cedula",
            "required": true,
            "schema": {
              "description": "Numero de cedula del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo_visita",
            "required": true,
            "schema": {
              "description": "Motivo de la visita",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/notificar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "notificar_residente",
        "timeout": "5s"
      },
      {
        "description": "OBLIGATORIO despues de notificar_residente. Verifica si el residente ya autorizo o denego. Llamar MULTIPLES VECES hasta obtener autorizado o denegado.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Numero de casa o apartamento",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/estado-autorizacion",
          "httpMethod": "POST"
        },
        "modelToolName": "estado_autorizacion",
        "timeout": "3s"
      },
      {
        "description": "Abre el porton. SOLO usar cuando estado_autorizacion retorne estado=autorizado.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo",
            "required": false,
            "schema": {
              "description": "Razon de apertura",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/abrir-porton",
          "httpMethod": "POST"
        },
        "modelToolName": "abrir_porton",
        "timeout": "5s"
      },
      {
        "description": "Transfiere a operador humano cuando no hay respuesta despues de varios intentos.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo",
            "required": false,
            "schema": {
              "description": "Motivo de la transferencia",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/transferir-operador",
          "httpMethod": "POST"
        },
        "modelToolName": "transferir_operador",
        "timeout": "3s"
      }
    ],
    "greetingMessage": "",
    "languageHint": "es-US",
    "maxDuration": "1800s",
    "model": "fixie-ai/ultravox-70B",
    "noResponseFinalMessage": "",
    "noResponseMessage": "",
    "password": "Sitnova20",
    "recipientURI": "sip:1000@172.20.20.1",
    "recordingEnabled": false,
    "systemPrompt": "You are a voice agent for a residential condominium in Costa Rica. Speak Spanish politely.\n\nYOUR JOB: Control access. Find residents, notify them, wait for authorization, open gate.\n\nCRITICAL TOOL USAGE RULE:\n- After notificar_residente, you MUST call estado_autorizacion MULTIPLE TIMES\n- Keep calling estado_autorizacion until you get \"autorizado\" or \"denegado\"\n- Between each estado_autorizacion call, say a waiting message to the visitor\n- NEVER say \"no pude contactar\" unless estado_autorizacion returns \"denegado\"\n\nCONVERSATION FLOW:\n\n1. GREETING: \"Buenas, a quien visita\"\n\n2. FIND RESIDENT:\n   - Use lookup_resident with what visitor said\n   - If found: \"Perfecto, encontre a [nombre] en [casa]\"\n   - If not found: \"No lo encuentro, me da el numero de casa\"\n\n3. COLLECT DATA (if needed):\n   - Name: \"Me regala su nombre completo\"\n   - Cedula: \"Me presta su numero de cedula\" then confirm digits\n   - Reason: \"Cual es el motivo de su visita\"\n   - Say: \"Muchas gracias\"\n\n4. NOTIFY RESIDENT:\n   - Say: \"Voy a comunicarme con el residente, un momento por favor\"\n   - Use notificar_residente with apartamento, nombre_visitante, cedula, motivo_visita\n   - Read the \"result\" field from the response\n\n5. WAIT FOR AUTHORIZATION (CRITICAL - FOLLOW EXACTLY):\n   After notificar_residente succeeds (enviado=true), you MUST:\n   \n   a) Say: \"Ya notifique al residente, estoy esperando su respuesta\"\n   b) Use estado_autorizacion with the apartamento\n   c) Check the \"estado\" field in the response:\n      - If \"pendiente\": Say \"Seguimos esperando\" and call estado_autorizacion AGAIN\n      - If \"autorizado\": Go to step 6\n      - If \"denegado\": Go to step 7\n   \n   KEEP REPEATING step 5b and 5c until you get \"autorizado\" or \"denegado\"\n   \n   Waiting messages to say between checks:\n   - \"Un momentito, estamos validando\"\n   - \"El residente esta revisando la solicitud\"\n   - \"Seguimos esperando la respuesta\"\n   - \"Gracias por su paciencia\"\n   \n   After 4-5 checks with \"pendiente\", offer to transfer: \"El residente no responde, desea que le comunique con un operador?\"\n\n6. AUTHORIZED:\n   - Say: \"Autorizado, puede pasar, que tenga buen dia\"\n   - Use abrir_porton\n   - End call\n\n7. DENIED:\n   - Say: \"Lo siento, el residente no autorizo el acceso, buen dia\"\n   - End call\n\n8. TRANSFER (if visitor agrees or timeout):\n   - Use transferir_operador\n   - Say: \"Le comunico con un operador\"\n   - End call\n\nIMPORTANT RULES:\n- ALWAYS read the \"result\" field from tool responses\n- NEVER invent responses - use what the tool returns\n- NEVER say \"no pude contactar\" if notificar_residente returned \"enviado\": true\n- KEEP calling estado_autorizacion until you get a final answer\n- Talk to the visitor between tool calls to maintain conversation\n\nSTYLE:\n- Brief, polite responses\n- Costa Rican expressions\n- No long explanations\n- Never share phone numbers",
    "temperature": 0.7,
    "timeExceededMessage": "",
    "timezone": "America/Costa_Rica",
    "userSpeaksFirst": false,
    "username": "1000",
    "voice": "b084d8f2-c9f9-491c-8059-d39dde80d58b"
  }
]
