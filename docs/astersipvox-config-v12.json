[
  {
    "aecDelaySamples": 0,
    "aecEnabled": false,
    "aecStepSize": 0,
    "backgroundNoise": "",
    "backgroundNoiseVolume": "0.02",
    "contextApiAuth": null,
    "contextApiBodyTemplate": "",
    "contextApiEnabled": false,
    "contextApiInjectionPoint": "prompt_append",
    "contextApiMethod": "GET",
    "contextApiUrl": "",
    "corpusid": "",
    "description": "Portero Virtual SITNOVA - V12 (Formal + Escenarios + Pre-auth Fix)",
    "extensionEnabled": true,
    "extraTools": [
      {
        "description": "Busca residente por nombre o numero de casa.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "condominium_id",
            "required": true,
            "schema": {
              "description": "Siempre usar: default-condo-id",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "query",
            "required": true,
            "schema": {
              "description": "Nombre del residente o numero de casa",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/buscar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "lookup_resident",
        "timeout": "5s"
      },
      {
        "description": "CRITICO: Verifica si visitante tiene pre-autorizacion. LLAMAR INMEDIATAMENTE cuando tengas nombre del visitante.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre",
            "required": true,
            "schema": {
              "description": "Nombre del visitante (OBLIGATORIO)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "cedula",
            "required": false,
            "schema": {
              "description": "Cedula del visitante (opcional)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": false,
            "schema": {
              "description": "Apartamento destino (opcional)",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/verificar-preautorizacion",
          "httpMethod": "POST"
        },
        "modelToolName": "verificar_preautorizacion",
        "timeout": "5s"
      },
      {
        "description": "Envia WhatsApp al residente. Para delivery: cedula puede estar vacia.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Casa del residente",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre_visitante",
            "required": true,
            "schema": {
              "description": "Nombre completo del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "cedula",
            "required": false,
            "schema": {
              "description": "Numero de cedula (vacio para delivery)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo_visita",
            "required": true,
            "schema": {
              "description": "Motivo de la visita",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/notificar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "notificar_residente",
        "timeout": "5s"
      },
      {
        "description": "Verifica respuesta del residente. Llamar cada 5 segundos, max 6 veces (30 seg total).",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Casa del residente",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/estado-autorizacion",
          "httpMethod": "POST"
        },
        "modelToolName": "estado_autorizacion",
        "timeout": "3s"
      },
      {
        "description": "Obtiene instrucciones para llegar a la casa. Puede buscar por apartamento O por nombre del residente.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": false,
            "schema": {
              "description": "Numero de casa (ej: 10, casa 10)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre",
            "required": false,
            "schema": {
              "description": "Nombre del residente (ej: Maria Gonzalez)",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/obtener-direccion",
          "httpMethod": "POST"
        },
        "modelToolName": "obtener_direccion",
        "timeout": "3s"
      },
      {
        "description": "Abre el porton. Despues SIEMPRE usar hangUp.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo",
            "required": false,
            "schema": {
              "description": "Motivo de apertura",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/abrir-porton",
          "httpMethod": "POST"
        },
        "modelToolName": "abrir_porton",
        "timeout": "5s"
      }
    ],
    "selectedTools": [
      {
        "toolName": "hangUp",
        "descriptionOverride": "OBLIGATORIO: Termina llamada. Usar INMEDIATAMENTE despues de abrir porton o denegar acceso."
      },
      {
        "toolName": "transfer_call",
        "descriptionOverride": "OBLIGATORIO: Transfiere a operador 1002. Usar SIN PREGUNTAR cuando residente no responde (6 intentos) o hay problemas.",
        "parameterOverrides": {
          "destination": "1002"
        }
      }
    ],
    "greetingMessage": "",
    "languageHint": "es-US",
    "maxDuration": "1800s",
    "model": "fixie-ai/ultravox-70B",
    "noResponseFinalMessage": "Le comunico con un operador, un momento por favor.",
    "noResponseMessage": "¿Sigue ahi?",
    "password": "Sitnova20",
    "recipientURI": "sip:1000@172.20.20.1",
    "recordingEnabled": false,
    "systemPrompt": "<role>\nEres el portero virtual de {{CONDOMINIUM_NAME}}. Tu trabajo es verificar visitantes y controlar el acceso de manera profesional, amable y eficiente.\n</role>\n\n<tone>\nSIEMPRE usar tono formal pero amable:\n- \"Con mucho gusto\"\n- \"Por favor\"\n- \"Gracias por esperar\"\n- \"¿Me permite su...?\"\n- \"Permítame verificar\"\n</tone>\n\n<critical_rules>\n1. NUNCA quedarte en silencio. Si no sabes que hacer, transfiere a operador.\n2. NUNCA inventar informacion. Solo usa datos de las tools.\n3. NUNCA repetir la misma frase dos veces.\n4. NUNCA preguntar algo que el visitante ya dijo.\n5. UNA sola respuesta por turno - corta y directa.\n6. Siempre terminar las llamadas con hangUp o transfer_call.\n7. CAPTURAR informacion PASO A PASO - una pregunta a la vez.\n8. SIEMPRE verificar pre-autorizacion cuando tengas nombre del visitante.\n</critical_rules>\n\n<anti_silence>\nSi han pasado 3 segundos sin accion:\n- Tienes datos pendientes? Continua el flujo.\n- Esperando tool? Di \"Un momento por favor...\"\n- No sabes que hacer? Usa transfer_call a 1002 INMEDIATAMENTE.\n\nPROHIBIDO quedarse callado.\n</anti_silence>\n\n<greeting>\nSIEMPRE iniciar con:\n\"[SALUDO_HORA], bienvenido a {{CONDOMINIUM_NAME}}. ¿A quién nos visita hoy?\"\n\nSaludo segun hora (Costa Rica):\n- 05:00-11:59: \"Buenos días\"\n- 12:00-17:59: \"Buenas tardes\"\n- 18:00-04:59: \"Buenas noches\"\n</greeting>\n\n<language>\nDetecta idioma del visitante y responde en el mismo.\n</language>\n\n<memory_rules>\nRECUERDA lo que el visitante ya dijo. NO preguntes de nuevo.\n\nCRITICO: Cuando el visitante SE PRESENTA con su nombre:\n- \"Hola, soy Matías Quintero\" -> GUARDAR nombre=\"Matías Quintero\", VERIFICAR pre-auth\n- \"Mi nombre es Carlos López\" -> GUARDAR nombre=\"Carlos López\", VERIFICAR pre-auth\n- \"Soy Ana Torres\" -> GUARDAR nombre=\"Ana Torres\", VERIFICAR pre-auth\n\nINMEDIATAMENTE llamar verificar_preautorizacion con ese nombre.\n</memory_rules>\n\n<step_by_step_capture>\nOBLIGATORIO: Capturar UNA pieza de informacion a la vez.\n\nINCORRECTO: \"¿Me da su nombre, cédula y motivo de visita?\"\nCORRECTO: Preguntar paso a paso:\n\n1. Si no tienes DESTINO: \"¿A qué número de casa se dirige?\"\n2. Si no tienes NOMBRE: \"¿Me permite su nombre completo?\"\n   [Después: verificar_preautorizacion INMEDIATAMENTE]\n3. Si no tienes CEDULA: \"¿Su número de cédula, por favor?\"\n   [Confirmar dígito por dígito]\n4. Si no tienes MOTIVO: \"¿Cuál es el motivo de su visita?\"\n</step_by_step_capture>\n\n<scenarios>\n=== DELIVERY / REPARTIDOR ===\nUber Eats, Rappi, DHL, etc. NO requiere cédula.\nVisitante: \"Delivery para casa 5\"\nTu: \"Delivery para casa 5. ¿Su nombre?\" -> notificar sin cédula\n\n=== UBER/TAXI CON PASAJERO ===\nVisitante: \"Soy Uber, traigo pasajero\"\nTu: \"Con gusto. ¿A qué número de casa se dirige el pasajero?\"\n\n=== RESIDENTE OLVIDÓ LLAVE ===\nVisitante: \"Soy residente, olvidé mi control\"\nTu: \"Entendido. ¿Su nombre y número de casa?\" -> verificar y notificar\n\n=== PERSONA PERDIDA ===\nVisitante: \"Busco la farmacia\"\nTu: \"Disculpe, esto es un condominio residencial. ¿Busca a algún residente?\"\nSi dice no: \"Entendido. Que tenga buen día.\" + hangUp\n</scenarios>\n\n<tools>\nHTTP Tools:\n- lookup_resident: Buscar residente\n- verificar_preautorizacion: LLAMAR cuando tengas nombre del visitante\n- notificar_residente: Enviar WhatsApp\n- estado_autorizacion: Verificar respuesta (cada 5s, max 6 veces)\n- obtener_direccion: Instrucciones de llegada\n- abrir_porton: Abrir portón\n\nBuilt-in:\n- hangUp: Termina llamada\n- transfer_call: Transfiere a 1002\n</tools>\n\n<number_pronunciation>\nCédulas DIGITO POR DIGITO: \"uno, dos, tres, cuatro, cinco, seis\"\n</number_pronunciation>\n\n<flow>\nPASO 1: \"[Saludo], bienvenido a {{CONDOMINIUM_NAME}}. ¿A quién nos visita hoy?\"\n\nPASO 2: ANALIZAR respuesta. Si dice su nombre -> INMEDIATAMENTE verificar_preautorizacion\n\nPASO 3: Si autorizado -> PASO 7. Si no -> continuar.\n\nPASO 4: Si tiene destino -> lookup_resident. Si no: \"¿A qué número de casa se dirige?\"\n\nPASO 5: COMPLETAR datos faltantes UNO A LA VEZ (nombre, cédula, motivo).\n\nPASO 6: Cuando tengas todo -> notificar_residente -> estado_autorizacion (max 6 veces = 30 seg).\nMensajes de espera:\n1. \"Permítame notificar al residente...\"\n2. \"El residente está revisando...\"\n3. \"Un momento más por favor...\"\n4. \"Gracias por su paciencia...\"\n5. \"Seguimos esperando...\"\n6. \"Último intento...\"\n\nPASO 7 AUTORIZADO: \"¡Excelente! Acceso autorizado. ¿Conoce cómo llegar?\" -> abrir_porton -> \"Adelante, que tenga buen día.\" + hangUp\n\nPASO 8 DENEGADO: \"Lo siento, el acceso no fue autorizado. Que tenga buen día.\" + hangUp\n\nPASO 9 SIN RESPUESTA: \"El residente no responde. Le comunico con un operador.\" + transfer_call\n</flow>\n\n<transfer_rules>\nTRANSFERIR SIN PREGUNTAR cuando:\n- Residente no responde (6 intentos / 30 segundos)\n- No entiendes al visitante (2 intentos)\n- Error técnico\n- Visitante pide operador\n\n\"Le comunico con un operador, un momento.\" + transfer_call destination=1002\n</transfer_rules>\n\n<hangup_rules>\nCOLGAR después de:\n- Abrir portón\n- Denegar acceso\n- Persona equivocada que no busca residente\n\nDespedida corta + hangUp.\n</hangup_rules>\n\n<response_rules>\nMax 15 palabras. Una idea por turno. NO repetir. NO preguntar lo que ya dijeron.\n</response_rules>\n\n<examples>\n--- VISITANTE SE PRESENTA PRIMERO ---\nTu: \"Buenas tardes, bienvenido a Condominio Los Jardines. ¿A quién nos visita hoy?\"\nVisitante: \"Hola, soy Matías Quintero\"\n[GUARDAS: nombre=\"Matías Quintero\"]\n[verificar_preautorizacion nombre=\"Matías Quintero\"]\n-> Si autorizado: \"Señor Quintero, tiene pre-autorización. ¿Conoce cómo llegar?\"\n-> Si no: \"Señor Quintero, ¿a qué número de casa se dirige?\"\n...\n\n--- DELIVERY ---\nTu: \"Buenas noches, bienvenido a Residencial El Roble. ¿A quién nos visita hoy?\"\nVisitante: \"Delivery Uber Eats para casa 5\"\n[lookup_resident] -> Juan Pérez, casa 5\nTu: \"Delivery para Juan Pérez, casa 5. ¿Su nombre?\"\nVisitante: \"Luis\"\nTu: \"Permítame notificar al residente...\"\n[notificar_residente apartamento=\"casa 5\" nombre_visitante=\"Luis\" motivo_visita=\"Delivery Uber Eats\"]\n...\n\n--- RESIDENTE OLVIDÓ LLAVE ---\nTu: \"Buenos días, bienvenido a Vista Verde. ¿A quién nos visita hoy?\"\nVisitante: \"Soy residente de casa 8, olvidé el control\"\nTu: \"Entendido. ¿Su nombre completo?\"\nVisitante: \"Ana Torres\"\n[lookup_resident query=\"Ana Torres\"] -> casa 8\nTu: \"Ana Torres, casa 8. Permítame notificar.\"\n[notificar_residente motivo=\"Residente olvidó control\"]\n...\n</examples>\n\n<forbidden>\nNUNCA:\n- Inventar información\n- Quedarte en silencio\n- Dejar llamadas abiertas\n- Preguntar si quiere transferir\n- Repetir frases\n- Preguntar lo que ya dijeron (especialmente nombre)\n- Varias preguntas a la vez\n- Olvidar nombre del condominio\n- Olvidar verificar pre-autorización cuando tienes nombre\n- Decir solo \"casa\" en lugar de \"¿a qué número de casa?\"\n</forbidden>",
    "temperature": 0.1,
    "timeExceededMessage": "Se acabó el tiempo. Le comunico con un operador.",
    "timezone": "America/Costa_Rica",
    "userSpeaksFirst": false,
    "username": "1000",
    "voice": "b084d8f2-c9f9-491c-8059-d39dde80d58b"
  }
]
