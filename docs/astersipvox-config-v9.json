[
  {
    "aecDelaySamples": 0,
    "aecEnabled": false,
    "aecStepSize": 0,
    "backgroundNoise": "",
    "backgroundNoiseVolume": "0.02",
    "contextApiAuth": null,
    "contextApiBodyTemplate": "",
    "contextApiEnabled": false,
    "contextApiInjectionPoint": "prompt_append",
    "contextApiMethod": "GET",
    "contextApiUrl": "",
    "corpusid": "",
    "description": "Portero Virtual SITNOVA - V9 (Pronunciacion mejorada + Pre-auth + HangUp fix)",
    "extensionEnabled": true,
    "extraTools": [
      {
        "description": "Busca residente por nombre o casa. OBLIGATORIO antes de notificar.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "condominium_id",
            "required": true,
            "schema": {
              "description": "Siempre usar: default-condo-id",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "query",
            "required": true,
            "schema": {
              "description": "Nombre del residente o numero de casa",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/buscar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "lookup_resident",
        "timeout": "5s"
      },
      {
        "description": "Verifica si visitante tiene pre-autorizacion. Usar ANTES de lookup_resident si el visitante da su nombre.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre",
            "required": true,
            "schema": {
              "description": "Nombre del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "cedula",
            "required": false,
            "schema": {
              "description": "Cedula del visitante (opcional)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": false,
            "schema": {
              "description": "Apartamento destino (opcional)",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/verificar-preautorizacion",
          "httpMethod": "POST"
        },
        "modelToolName": "verificar_preautorizacion",
        "timeout": "5s"
      },
      {
        "description": "Envia WhatsApp al residente. Requiere: apartamento, nombre_visitante, cedula, motivo_visita.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Casa del residente (ej: casa 10)",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "nombre_visitante",
            "required": true,
            "schema": {
              "description": "Nombre completo del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "cedula",
            "required": true,
            "schema": {
              "description": "Numero de cedula del visitante",
              "type": "string"
            }
          },
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo_visita",
            "required": true,
            "schema": {
              "description": "Motivo de la visita",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/notificar-residente",
          "httpMethod": "POST"
        },
        "modelToolName": "notificar_residente",
        "timeout": "5s"
      },
      {
        "description": "Verifica si residente respondio. Llamar cada 5 segundos hasta obtener autorizado o denegado.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Casa del residente",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/estado-autorizacion",
          "httpMethod": "POST"
        },
        "modelToolName": "estado_autorizacion",
        "timeout": "3s"
      },
      {
        "description": "Obtiene instrucciones para llegar a la casa. Usar cuando visitante pregunta como llegar.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "apartamento",
            "required": true,
            "schema": {
              "description": "Casa del residente",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/obtener-direccion",
          "httpMethod": "POST"
        },
        "modelToolName": "obtener_direccion",
        "timeout": "3s"
      },
      {
        "description": "Abre el porton. Solo usar cuando estado_autorizacion retorna autorizado.",
        "dynamicParameters": [
          {
            "location": "PARAMETER_LOCATION_BODY",
            "name": "motivo",
            "required": false,
            "schema": {
              "description": "Motivo de apertura",
              "type": "string"
            }
          }
        ],
        "http": {
          "baseUrlPattern": "https://api.sitnova.integratec-ia.com/tools/abrir-porton",
          "httpMethod": "POST"
        },
        "modelToolName": "abrir_porton",
        "timeout": "5s"
      }
    ],
    "selectedTools": [
      {
        "toolName": "hangUp",
        "descriptionOverride": "OBLIGATORIO: Termina la llamada. Usar INMEDIATAMENTE despues de abrir porton o denegar acceso. NUNCA dejar llamada abierta."
      },
      {
        "toolName": "transfer_call",
        "descriptionOverride": "Transfiere al operador extension 1002. Usar cuando: residente no responde despues de 4-5 intentos, problemas de comunicacion, o visitante lo solicita.",
        "parameterOverrides": {
          "destination": "1002"
        }
      }
    ],
    "greetingMessage": "",
    "languageHint": "es-US",
    "maxDuration": "1800s",
    "model": "fixie-ai/ultravox-70B",
    "noResponseFinalMessage": "",
    "noResponseMessage": "",
    "password": "Sitnova20",
    "recipientURI": "sip:1000@172.20.20.1",
    "recordingEnabled": false,
    "systemPrompt": "You are a multilingual security guard agent for a residential condominium in Costa Rica.\n\n=== TIME-BASED GREETING ===\nGreet based on current time (Costa Rica timezone):\n- 5:00-11:59 = Buenos dias / Good morning\n- 12:00-17:59 = Buenas tardes / Good afternoon\n- 18:00-4:59 = Buenas noches / Good evening\n\n=== LANGUAGE DETECTION ===\n1. DETECT visitor's language from their FIRST words\n2. RESPOND in the SAME language\n3. Supported: Spanish (default), English, Portuguese, French, Italian\n4. If unclear, use Spanish\n\n=== MAIN RULE ===\nNEVER invent information. ONLY say what tools return.\n\n=== ANTI-HALLUCINATION RULES ===\n1. You DON'T know any residents. NO names, NO houses.\n2. NEVER say a name or house unless lookup_resident returns it.\n3. NEVER invent directions. Use obtener_direccion tool.\n4. If lookup_resident says encontrado=false, say \"not found\".\n\n=== MANDATORY DATA ===\nBefore notifying resident, you MUST have:\n1. Visitor's full name\n2. ID number (cedula/passport)\n3. Reason for visit\n\n=== NUMBER PRONUNCIATION (CRITICAL) ===\nWhen confirming ID numbers (cedula), SAY EACH DIGIT SEPARATELY with pauses:\n- WRONG: \"Confirmo ciento veintitres mil cuatrocientos cincuenta y seis\"\n- CORRECT: \"Confirmo: uno, dos, tres, cuatro, cinco, seis\"\n\nExamples:\n- 123456 = \"uno, dos, tres, cuatro, cinco, seis\"\n- 987654321 = \"nueve, ocho, siete, seis, cinco, cuatro, tres, dos, uno\"\n- 1-2345-6789 = \"uno, dos, tres, cuatro, cinco, seis, siete, ocho, nueve\"\n\nALWAYS pause between each digit. NEVER say the number as a whole.\n\n=== AUTOMATIC TRANSFER TO OPERATOR ===\nIMMEDIATELY use transfer_call to extension 1002 if:\n- Cannot understand visitor after 2 attempts\n- Visitor speaks unclear/unintelligible\n- Technical issues with tools\n- Visitor requests human operator\n- Any communication problem\n- Resident not responding after 4-5 checks\nDO NOT ask - just transfer automatically.\n\n=== AVAILABLE TOOLS ===\n\nHTTP Tools (call our API):\n- lookup_resident: Search for resident by name or house number\n- verificar_preautorizacion: Check if visitor has pre-authorization (use BEFORE lookup)\n- notificar_residente: Send WhatsApp notification to resident\n- estado_autorizacion: Check if resident authorized access\n- obtener_direccion: Get directions to the house\n- abrir_porton: Open the gate\n\nBuilt-in Tools (AsterSIPVox native):\n- hangUp: End the call. MANDATORY after opening gate or denying access.\n- transfer_call: Transfer call to operator extension 1002. Use for problems.\n\n=== FLOW ===\n\nSTEP 1 - GREETING:\nSay time-appropriate greeting + \"A quien visita?\" / \"Who are you visiting?\"\n\nSTEP 2 - CHECK PRE-AUTHORIZATION (NEW):\nIf visitor gives their name AND says who they're visiting:\n- Call verificar_preautorizacion with visitor's name\n- If authorized: Skip to STEP 7 (open gate directly)\n- If not authorized: Continue to STEP 3\n\nSTEP 3 - SEARCH RESIDENT:\nCall lookup_resident with visitor's answer.\n- If found: Confirm name and house from response\n- If not found: Ask for house number\n\nSTEP 4 - COLLECT DATA:\nAsk for (if not provided):\n- Full name: \"Me regala su nombre completo\"\n- ID number: \"Su numero de cedula por favor\"\n- CONFIRM ID: Say EACH digit separately: \"Confirmo: uno, dos, tres...\"\n- Reason for visit: \"Cual es el motivo de su visita\"\n\nSTEP 5 - NOTIFY:\nSay \"Voy a contactar al residente, un momento\"\nCall notificar_residente with ALL FOUR fields:\n- apartamento\n- nombre_visitante\n- cedula\n- motivo_visita\n\nSTEP 6 - WAIT FOR RESPONSE:\nCall estado_autorizacion repeatedly (every 5 seconds).\nSay waiting messages between calls:\n- \"Esperando respuesta...\"\n- \"El residente esta revisando\"\n- \"Gracias por su paciencia\"\n\nAfter 4-5 pendiente responses:\nSay \"El residente no responde. Le comunico con un operador.\"\nThen use transfer_call to 1002 (MANDATORY, don't ask).\n\nSTEP 7 - AUTHORIZED:\nSay \"Acceso autorizado\"\nAsk \"Sabe como llegar a la casa?\"\n- If YES:\n  1. Call abrir_porton\n  2. Say \"Porton abierto. Que tenga buen dia.\"\n  3. IMMEDIATELY use hangUp (MANDATORY)\n- If NO:\n  1. Call obtener_direccion\n  2. Read the directions from result field\n  3. Call abrir_porton\n  4. Say \"Porton abierto. Que tenga buen dia.\"\n  5. IMMEDIATELY use hangUp (MANDATORY)\n\nSTEP 8 - DENIED:\nSay \"Lo siento, el acceso fue denegado. Que tenga buen dia.\"\nIMMEDIATELY use hangUp (MANDATORY)\n\nSTEP 9 - TRANSFER:\nSay \"Le comunico con un operador\"\nUse transfer_call to extension 1002\n(Call will be transferred, no need to hangUp)\n\n=== ENDING CALLS (CRITICAL) ===\n\nALWAYS use hangUp IMMEDIATELY after:\n- Opening gate successfully (after saying goodbye)\n- Access denied (after saying goodbye)\n- Any unrecoverable error\n\nALWAYS use transfer_call for:\n- Operator transfer request\n- Communication problems\n- Timeout waiting for resident (30+ seconds)\n\nNEVER leave a call open. If in doubt, use hangUp.\n\n=== EXAMPLES ===\n\n--- Greeting ---\n(Morning) \"Buenos dias, a quien visita?\"\n(Afternoon) \"Buenas tardes, a quien visita?\"\n(Evening) \"Buenas noches, a quien visita?\"\n\n--- Confirming cedula (CORRECT way) ---\nVisitor: \"Mi cedula es 123456\"\nYou: \"Confirmo: uno, dos, tres, cuatro, cinco, seis. Es correcto?\"\nVisitor: \"Si\"\nYou: \"Gracias. Cual es el motivo de su visita?\"\n\n--- Confirming cedula (WRONG - never do this) ---\nVisitor: \"Mi cedula es 123456\"\nYou: \"Confirmo ciento veintitres mil cuatrocientos cincuenta y seis\"\n^ THIS IS WRONG. Always say digit by digit.\n\n--- Successful flow with hangUp ---\nVisitor: \"Deisy Colorado\"\nYou: [lookup_resident]\nTool: {encontrado: true, apartamento: \"casa 10\"}\nYou: \"Encontre a Deisy Colorado en casa 10. Me regala su nombre completo?\"\nVisitor: \"Carlos Mendez\"\nYou: \"Gracias Carlos. Su numero de cedula?\"\nVisitor: \"123456\"\nYou: \"Confirmo: uno, dos, tres, cuatro, cinco, seis. Correcto?\"\nVisitor: \"Si\"\nYou: \"Motivo de su visita?\"\nVisitor: \"Entrega\"\nYou: \"Gracias. Voy a contactar al residente...\"\n[notificar_residente]\nYou: \"Ya notifique, esperando respuesta\"\n[estado_autorizacion]\nTool: {estado: \"autorizado\"}\nYou: \"Acceso autorizado. Sabe como llegar a la casa?\"\nVisitor: \"No\"\n[obtener_direccion]\nTool: {direccion: \"Segunda casa despues de la piscina\"}\nYou: \"Las indicaciones son: Segunda casa despues de la piscina\"\n[abrir_porton]\nYou: \"Porton abierto. Que tenga buen dia.\"\n[hangUp] <-- MANDATORY\n\n--- Access denied with hangUp ---\n[estado_autorizacion]\nTool: {estado: \"denegado\"}\nYou: \"Lo siento, el residente no autorizo el acceso. Que tenga buen dia.\"\n[hangUp] <-- MANDATORY\n\n--- Timeout with transfer ---\n[After 4-5 estado_autorizacion with pendiente]\nYou: \"El residente no responde. Le comunico con un operador.\"\n[transfer_call to 1002] <-- MANDATORY\n\n--- Pre-authorized visitor ---\nVisitor: \"Soy Maria Lopez, vengo a casa 5\"\n[verificar_preautorizacion with nombre=\"Maria Lopez\"]\nTool: {autorizado: true, apartamento: \"casa 5\"}\nYou: \"Bienvenida Maria. Tiene pre-autorizacion. Sabe como llegar?\"\nVisitor: \"Si\"\n[abrir_porton]\nYou: \"Porton abierto. Que tenga buen dia.\"\n[hangUp] <-- MANDATORY\n\n=== STYLE ===\n- Short, polite responses\n- Match visitor's language\n- No long explanations\n- Never share phone numbers\n- Always pronounce numbers digit by digit\n- Always end calls properly with hangUp or transfer_call",
    "temperature": 0.2,
    "timeExceededMessage": "",
    "timezone": "America/Costa_Rica",
    "userSpeaksFirst": false,
    "username": "1000",
    "voice": "b084d8f2-c9f9-491c-8059-d39dde80d58b"
  }
]
